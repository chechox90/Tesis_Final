
@{
    ViewBag.Title = "Dashboard";
}


<h2>Dashboard</h2>

<div class="col-12">
    <div class="form-row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body" height="100">
                    <div id="AguaNoUsada" class="h-100 d-flex"></div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <div id="PapelNoUsado" class="h-100 d-flex"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<br />
<div class="col-md-12 card" id="divTablaHorarios">
    <table id="tblVueltas" class="table table-striped table-hover">
    </table>
</div>

@section scripts
{

    <script src="~/Plugins/package/dist/chart.js"></script>

    <script>
        var tblVueltas;

        $(document).ready(function () {
            graficoIncio();
            CargarVueltas();
        });

        function graficoIncio() {
            Highcharts.chart('AguaNoUsada', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: 'Resumen de horas laborales',
                    align: 'left',
                    style: {
                        fontSize: '1.25rem'
                    }
                },
                legend: {
                    align: 'right',
                    verticalAlign: 'top',
                    layout: 'vertical',
                    labelFormat: '{name} <span style="color:#34394F;"> {y}</span>',
                    itemMarginBottom: 15,
                    itemStyle: {
                        fontSize: "14px",
                        fontWeight: "500",
                        color: "#6E7B8F"
                    },
                    itemHoverStyle: {
                        color: "#34394F"
                    },
                    itemHiddenStyle: {
                        color: "rgba(110, 123, 143, .4)"
                    },
                    y: 80,
                    x: -40
                },
                tooltip: {
                    headerFormat: '<span style="font-size:16px"></span><br>',
                    pointFormat: '<span style="color:rgba(255,255,255,.75);">{point.name}: </span> <b> {point.y}</b>',
                    padding: 8,
                    borderRadius: 8,
                    borderColor: '#34394F',
                    backgroundColor: '#34394F',
                    style: {
                        fontSize: '12px',
                        color: '#FFF'
                    },
                    shadow: false
                },
                lang: {
                    printChart: '<i class="far fa-print mr-2"></i> Imprimir',
                    downloadPNG: '<i class="far fa-file-image mr-2"></i> Descargar PNG',
                    downloadJPEG: '<i class="fas fa-file-image mr-2"></i> Descargar JPG',
                    downloadPDF: '<i class="far fa-file-pdf mr-2"></i> Descargar PDF',
                    downloadXLS: '<i class="far fa-cloud-download mr-2"></i> Descargar Excel',
                    exportData: {
                        categoryHeader: 'Categoría'
                    }
                },
                exporting: {
                    buttons: {
                        contextButton: {
                            symbol: 'menuball',
                            symbolSize: 13,
                            symbolFill: '#6E7B8F',
                            symbolStrokeWidth: 2,
                            symbolStroke: '#6E7B8F',
                            menuItems: ['downloadPNG', 'downloadJPEG', 'downloadPDF', 'separator', 'downloadXLS']
                        }
                    }
                },
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 500
                        },
                        chartOptions: {
                            legend: {
                                align: 'left',
                                verticalAlign: 'top',
                                layout: 'horizontal',
                                itemMarginBottom: 6,
                                y: 0,
                                x: -8
                            },
                            yAxis: {
                                labels: {
                                    align: 'left',
                                    x: 0,
                                    y: -5
                                },
                                title: {
                                    text: null
                                }
                            },
                            subtitle: {
                                text: null
                            },
                            credits: {
                                enabled: false
                            }
                        }
                    }]
                },
                plotOptions: {
                    pie: {
                        colors: [
                            "#006BE6",
                            "#FFD000"
                        ],
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            style: {
                                fontSize: 13,
                                fontFamily: 'Roboto',
                                textOutline: 0,
                            },
                            format: '<b>{point.name}</b><br/> {point.percentage:.1f} %',
                            distance: -40,
                            y: -10
                        }
                    },
                },
                series: [{
                    name: 'Total',
                    colorByPoint: true,
                    size: '80%',
                    innerSize: '45%',
                    showInLegend: true,
                    data: [{
                        name: 'Horas trabajadas',
                        y: parseInt(90)
                    }, {
                        name: 'Horas de descanso',
                        y: parseInt(180)
                    }],
                }],
                credits: {
                    enabled: false
                },
            });



            Highcharts.chart('PapelNoUsado', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'column'
                },
                title: {
                    text: 'Comparación de papel usado vs ahorrado',
                    align: 'left',
                    style: {
                        fontSize: '1.25rem'
                    }
                },
                legend: {
                    align: 'right',
                    verticalAlign: 'top',
                    layout: 'vertical',
                    labelFormat: '{name} <span style="color:#34394F;"> {y}</span>',
                    itemMarginBottom: 15,
                    itemStyle: {
                        fontSize: "14px",
                        fontWeight: "500",
                        color: "#6E7B8F"
                    },
                    itemHoverStyle: {
                        color: "#34394F"
                    },
                    itemHiddenStyle: {
                        color: "rgba(110, 123, 143, .4)"
                    },
                    y: 80,
                    x: -40
                },
                tooltip: {
                    headerFormat: '<span style="font-size:16px"></span><br>',
                    pointFormat: '<span style="color:rgba(255,255,255,.75);">{point.name}: </span> <b> {point.y}</b>',
                    padding: 8,
                    borderRadius: 8,
                    borderColor: '#34394F',
                    backgroundColor: '#34394F',
                    style: {
                        fontSize: '12px',
                        color: '#FFF'
                    },
                    shadow: false
                },
                lang: {
                    printChart: '<i class="far fa-print mr-2"></i> Imprimir',
                    downloadPNG: '<i class="far fa-file-image mr-2"></i> Descargar PNG',
                    downloadJPEG: '<i class="fas fa-file-image mr-2"></i> Descargar JPG',
                    downloadPDF: '<i class="far fa-file-pdf mr-2"></i> Descargar PDF',
                    downloadXLS: '<i class="far fa-cloud-download mr-2"></i> Descargar Excel',
                    exportData: {
                        categoryHeader: 'Categoría'
                    }
                },
                exporting: {
                    buttons: {
                        contextButton: {
                            symbol: 'menuball',
                            symbolSize: 13,
                            symbolFill: '#6E7B8F',
                            symbolStrokeWidth: 2,
                            symbolStroke: '#6E7B8F',
                            menuItems: ['downloadPNG', 'downloadJPEG', 'downloadPDF', 'separator', 'downloadXLS']
                        }
                    }
                },
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 500
                        },
                        chartOptions: {
                            legend: {
                                align: 'left',
                                verticalAlign: 'top',
                                layout: 'horizontal',
                                itemMarginBottom: 6,
                                y: 0,
                                x: -8
                            },
                            yAxis: {
                                labels: {
                                    align: 'left',
                                    x: 0,
                                    y: -5
                                },
                                title: {
                                    text: null
                                }
                            },
                            subtitle: {
                                text: null
                            },
                            credits: {
                                enabled: false
                            }
                        }
                    }]
                },
                plotOptions: {
                    series: {
                        grouping: false,
                        borderWidth: 0
                    }
                },
                series: [{
                    color: 'rgb(158, 159, 163)',
                    pointPlacement: -0.2,
                    linkedTo: 'main',
                    data: [{
                        name: 'Hojas no usadas',
                        y: parseInt(8000)
                    }, {
                        name: 'Hojas usadas',
                        y: parseInt(10000)
                    }],
                }],
                credits: {
                    enabled: false
                },
            });
        }

        function CargarVueltas() {
            tblVueltas = $("#tblVueltas").DataTable({
                dom: "<'card-header flex-column flex-lg-row align-items-start align-items-lg-center'<'d-flex flex-column flex-lg-row justify-content-start align-items-lg-center'<'titleRev mr-2'><'comboFil mb-2 mb-lg-0'>><'d-flex justify-content-md-end'fl>>" + "<'card-body p-0'tr>" + "<'card-footer'ip>",
                scrollX: true,
                processing: true,
                destroy: true,
                lengthChange: true,
                pageLength: 10,
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
                columnDefs: [
                    { targets: [0, 3, 4], searchable: false, orderable: false }
                ],
                language: {
                    "url": "../Plugins/DataTables/js/Spanish.json"
                },
                order: [[1, "asc"]],
                initComplete: function () {
                    $($.fn.dataTable.tables(true)).DataTable().columns.adjust();
                },
                ajax: {
                    url: "../Mantenedor/GetRegistroVueltasFechaActual",
                    type: "POST",
                    dataType: "json",
                    data: null
                },
                columns: [
                    { data: "ID_REGISTRO_VUELTAS", visible: false, searchable: false },
                    { data: "NOMBRE_TERMINAL_INICIO", title: "Terminal inicio", name: "NOMBRE_TERMINAL_INICIO", orderable: false },
                    { data: "NUMERO_BUS_INICIO", title: "Bus inicio", name: "NUMERO_BUS_INICIO", orderable: false },
                    { data: "NOMBRE_SERVICIO_INICIO", title: "Servicio inicio", name: "NOMBRE_SERVICIO_INICIO", orderable: false },
                    { data: "SEN_INI_CORTO", title: "Sentido inicio", name: "SEN_INI_CORTO", orderable: false },
                    {
                        data: null, title: "Fecha Inicio", name: "FECHA_HORA_INICIO", render:
                            function (full) {
                                if (moment(full.FECHA_HORA_INICIO).format('DD/MM/YYYY') != '31/12/0000') {
                                    return moment(full.FECHA_HORA_FIN).format('DD/MM/YYYY');
                                } else {
                                    return "";
                                }

                            }
                    },
                    { data: "NOMBRE_TERMINAL_FIN", title: "Terminal fin", name: "NOMBRE_TERMINAL_FIN", orderable: false },
                    { data: "NOMBRE_SERVICIO_FIN", title: "Servicio fin", name: "NOMBRE_SERVICIO_FIN", orderable: false },
                    { data: "SEN_FIN_CORTO", title: "Sentido fin", name: "SEN_FIN_CORTO", orderable: false },
                    { data: "NUMERO_BUS_FIN", title: "Bus fin", name: "NOMBRE_EMPRESA", orderable: false },
                    {
                        data: null, title: "Fecha fin", name: "FECHA_HORA_FIN", render:
                            function (full) {
                                if (moment(full.FECHA_HORA_FIN).format('DD/MM/YYYY') != '31/12/0000') {
                                    return moment(full.FECHA_HORA_FIN).format('DD/MM/YYYY');
                                } else {
                                    return "";
                                }

                            }
                    },
                ]
            });
        }

    </script>
}